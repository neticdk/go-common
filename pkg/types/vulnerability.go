package types

// Vulnerability represents a vulnerability
type Vulnerability struct {
	ID          string
	PackageName string
	Description string
	Severity    string
	FixState    string
	CVSS        *CVSS
}

// CVSS represents the Common Vulnerability Scoring System
type CVSS struct {
	Version   string
	Vector    string
	BaseScore float64
}

// VulnerabilityCDXFile represents the vulnerability file format
type VulnerabilityCDXFile struct {
	CreatedAt string `json:"CreatedAt"`
	CDXResult []ResultDCDX `json:"Results"`
}

type ResultDCDX struct {
	Target             string              `json:"Target"`
	Class              string              `json:"Class"`
	Type               string              `json:"Type"`
	CDXVulnerabilities []VulnerabilityDCDX `json:"Vulnerabilities,omitempty"`
}

type VulnerabilityDCDX struct {
	ID               string        `json:"VulnerabilityID"`
	PackageName      string        `json:"PkgName"`
	PackageId        PkgIdentifier `json:"PkgIdentifier"`
	Description      string        `json:"Title"`
	Severity         string        `json:"Severity"`
	Status           string        `json:"Status,omitempty"`
	PublishedDate    string        `json:"PublishedDate,omitempty"`
	LastModifiedDate string        `json:"LastModifiedDate,omitempty"`
	CWEs             []string      `json:"CweIDs,omitempty"`
	CVSS             CVSSDCDX      `json:"CVSS,omitempty"`
	References       []string      `json:"References,omitempty"`
}

type PkgIdentifier struct {
	PURL   string `json:"PURL"`
	UID    string `json:"UID"`
	BOMRef string `json:"BOMRef"`
}
type CVSSDCDX struct {
	NVD    ScoreCDX `json:"nvd,omitempty"`
	REDHAT ScoreCDX `json:"redhat,omitempty"`
	GHSA   ScoreCDX `json:"ghsa,omitempty"`
}

type ScoreCDX struct {
	V3Vector string  `json:"V3Vector,omitempty"`
	V3Score  float64 `json:"V3Score,omitempty"`
	V2Vector string  `json:"V2Vector,omitempty"`
	V2Score  float64 `json:"V2Score,omitempty"`
}

type VulnerabilityCDX struct {
	ID          string   `json, yaml:"cveID"`
	Vexed       string   `json, yaml:"vexed"`
	Exploited   string   `json, yaml:"exploited"`
	Dependency  string   `json, yaml:"dependency"`
	PackageName string   `json, yaml:"packageName"`
	Description string   `json, yaml:"description"`
	Severity    string   `json, yaml:"severity"`
	FixState    string   `json, yaml:"fixState"`
	Published   string   `json, yaml:"published"`
	Modified    string   `json, yaml:"modified"`
	CVSS        CVSSDCDX `json, yaml:"cvss"`
	CWEs        []string `json, yaml:"cweIDs"`
	References  []string `json, yaml:"references"`
}

// VulnerabilityAnalytics represents the analytics of a set of vulnerabilities
// across releases of an upstream project. This represents the observed
// analytics data for a set of releases for a single upstream project.
type VulnerabilityAnalytics struct {
	Entries []VulnerabilityAnalyticEntry `json, yaml:"entries"`
	Summary string                       `json, yaml:"summary"`
	Verdict string                       `json, yaml:"verdict"`
}

// VulnerabilityAnalyticEntry represents the analytics of a
// vulnerability set for a single release for the concrete
type VulnerabilityAnalyticEntry struct {
	ReleaseName string                `json, yaml:"release"`
	ReleasedAt  string                `json, yaml:"releasedAt"`
	ScannedAt   string                `json, yaml:"scannedAt"`
	SBOMCreated string                `json, yaml:"sbomCreatedAt"`
	VEXCreated  string                `json, yaml:"vexCreatedAt"`
	Vex         []VEXCDX              `json, yaml:"vex"`
	Criticals   []VulnerabilityVector `json, yaml:"criticals"`
	Highs       []VulnerabilityVector `json, yaml:"highs"`
	Mediums     []VulnerabilityVector `json, yaml:"mediums"`
	Lows        []VulnerabilityVector `json, yaml:"lows"`
}

// VulnerabilityVector represents the vector of a single set of vulnerability
type VulnerabilityVector struct {
	Severity     string   `json, yaml:"severity"`
	FixState     string   `json, yaml:"fixState"`
	FixTime      string   `json, yaml:"fixTime"`
	Published    string   `json, yaml:"published"`
	Modified     string   `json, yaml:"modified"`
	CVEAge       string   `json, yaml:"age"`
	CVE          string   `json, yaml:"cve"`
	CWEs         []string `json, yaml:"cWEs"`
	SinceRelease []string `json, yaml:"since"`
	CVSS         CVSSDCDX `json, yaml:"cVSs"`
}

// Vulnerability Exploitation File format
type VEXCDXFile struct {
	BOMFormat       string   `json,yaml:"bomFormat"`
	SpecVersion     string   `json,yaml:"specVersion"`
	Version         int      `json,yaml:"version"`
	Metadata        Metadata `json,yaml:"metadata"`
	Vulnerabilities []VEXCDX `json,yaml:"vulnerabilities"`
}
type VEXCDX struct {
	ID       string    `json,yaml:"id"`
	Analysis Analysis  `json,yaml:"analysis"`
	Affects  []Affects `json,yaml:"affects"`
}
type Analysis struct {
	State         string   `json,yaml:"state"`
	Justification string   `json,yaml:"justification"`
	Response      []string `json,yaml:"response"`
	Detail        string   `json,yaml:"detail"`
}
type Affects struct {
	Ref string `json,yaml:"ref"`
}

type Exploits struct {
	CVE            string `json:"id"`
	EarliestReport string `json:"earliestReport"`
}
